function Vector(e){this.element=e}function Move(e){this.element=e}function Painter(e){this.element=e,this.paintClass="painted",this.villanPaintClass="villan-painted"}function Character(e){this.element=document.getElementById(e),this.move=new Move(this.element),this.painter=new Painter(this.element)}function Player(e){this.character=e,this.arrowKeys=[38,39,40,37],this.score=document.getElementById("player-score"),this.controls=[38,39,40,37]}function Villan(e){this.character=e,this.arrowKeys=[38,39,40,37],this.speed=75,this.score=document.getElementById("villan-score"),this.playing=null}function Game(e,t,n){this.player=new Player(new Character(e)),this.villan=new Villan(new Character(t)),this.cells=document.getElementsByClassName("cell"),this.clock={element:document.getElementById("clock"),timeElement:document.getElementById("clockTime"),timeLimit:n,timeLeft:n,running:null},this.startButton={element:document.getElementById("start-button"),handler:this.enableButton(document.getElementById("start-button"))},this.winner=document.getElementById("winner")}var Util=function(){return{childIndex:function(e,t){for(var n=t.length,i=0;i<n;++i)if(e===t[i])return i},hasClass:function(e,t){return(" "+e.className+" ").indexOf(" "+t+" ")>-1},doesntHaveClass:function(e,t){return!this.hasClass(e,t)},randomElement:function(e){return e[Math.floor(Math.random()*e.length)]},removeClass:function(e,t){this.hasClass(e,t)&&e.classList.remove(t)}}}(),EventHandler=function(){var e=0,t=[];return{addListener:function(n,i,r){return e++,r.addEventListener(n,i),t[e]={event:n,handler:i,element:r},e},removeListener:function(e){if(e in t){var n=t[e];n.element.removeEventListener(n.event,n.handler),delete t[e]}}}}();Vector.prototype.north=function(){var e=this.element.parentElement,t=e.parentElement,n=t.children,i=Util.childIndex(e,n),r=t.previousElementSibling;return r?r.children[i]:null},Vector.prototype.east=function(){return this.element.parentElement.nextElementSibling},Vector.prototype.south=function(){var e=this.element.parentElement,t=e.parentElement,n=t.children,i=Util.childIndex(e,n),r=t.nextElementSibling;return r?r.children[i]:null},Vector.prototype.west=function(){return this.element.parentElement.previousElementSibling},Move.prototype.direction=function(e){switch(e){case 38:this.north(new Vector(this.element));break;case 39:this.east(new Vector(this.element));break;case 40:this.south(new Vector(this.element));break;case 37:this.west(new Vector(this.element));break;default:return!1}},Move.prototype.north=function(e){return e.north()&&e.north().appendChild(e.element),!1},Move.prototype.east=function(e){return e.east()&&e.east().appendChild(e.element),!1},Move.prototype.south=function(e){return e.south()&&e.south().appendChild(e.element),!1},Move.prototype.west=function(e){return e.west()&&e.west().appendChild(e.element),!1},Painter.prototype.paint=function(){this.removePaint(this.villanPaintClass),Util.doesntHaveClass(this.element.parentElement,this.paintClass)&&(this.element.parentElement.className+=" "+this.paintClass)},Painter.prototype.removePaint=function(e){Util.removeClass(this.element.parentElement,e)},Painter.prototype.villanPaint=function(){this.removePaint(this.paintClass),Util.doesntHaveClass(this.element.parentElement,this.villanPaintClass)&&(this.element.parentElement.className+=" "+this.villanPaintClass)},Player.prototype.play=function(){var e=this,t=e.controls;window.onkeydown=function(n){t.indexOf(n.keyCode)>-1&&(n.preventDefault(),e.character.move.direction(n.keyCode),e.character.painter.paint(),e.updateScore())}},Player.prototype.currentScore=function(){return document.getElementsByClassName("painted").length},Player.prototype.updateScore=function(){this.score.innerHTML=this.currentScore()},Player.prototype.stop=function(){controls=this.controls,window.onkeydown=function(e){if(controls.indexOf(e.keyCode)>-1)return!0}},Villan.prototype.play=function(){var e=this;e.playing=setInterval(function(){var t=Util.randomElement(e.arrowKeys);e.character.move.direction(t),e.character.painter.villanPaint(),e.updateScore()},e.speed)},Villan.prototype.currentScore=function(){return document.getElementsByClassName("villan-painted").length},Villan.prototype.updateScore=function(){this.score.innerHTML=this.currentScore()},Villan.prototype.stop=function(){clearInterval(this.playing)},Game.prototype.enableButton=function(e){return game=this,Util.removeClass(e,"disabled"),EventHandler.addListener("click",function(){game.start()},e)},Game.prototype.disableButton=function(e){return e.element.className+=" disabled",EventHandler.removeListener(e.handler)},Game.prototype.start=function(){this.reset(),this.disableButton(this.startButton),this.startClock(),this.player.play(),this.villan.play()},Game.prototype.startClock=function(){var e=this,t=e.clock.element.parentElement;Util.removeClass(e.clock.timeElement,"clock-stop"),e.clock.timeElement.innerHTML=e.clock.timeLimit/1e3+"s",Util.doesntHaveClass(t,"show")&&(t.className+=" show"),this.clock.running=setInterval(function(){e.runClock()},1e3)},Game.prototype.runClock=function(){return this.clock.timeLeft-=1e3,this.clock.timeElement.innerHTML="<span>"+this.clock.timeLeft/1e3+"s</span>",1e4===this.clock.timeLeft&&(this.clock.timeElement.className+=" clock-warning"),0===this.clock.timeLeft&&(this.stopClock(),this.gameOver()),!1},Game.prototype.stopClock=function(){clearInterval(this.clock.running),Util.removeClass(this.clock.timeElement,"clock-warning"),this.clock.timeElement.className+=" clock-stop"},Game.prototype.gameOver=function(){var e=this.player,t=this.villan;e.stop(),t.stop(),e.updateScore(),t.updateScore();var n=e.currentScore(),i=t.currentScore();n>i&&(this.winner.innerHTML="You win!",this.winningCharacter(this.player.character),this.mouth("player-mouth","smile"),this.mouth("villan-mouth","frown")),n<i&&(this.winner.innerHTML="You lose!",this.mouth("player-mouth","frown"),this.winningCharacter(this.villan.character),this.mouth("villan-mouth","smile")),n===i&&(this.winner.innerHTML="It's a tie!"),this.startButton.handler=this.enableButton(this.startButton.element)},Game.prototype.reset=function(){this.resetCharacters(),this.resetBoard(),this.resetScore(),this.clock.timeLeft=this.clock.timeLimit,this.clock.timeElement.innerHTML=this.clock.timeLimit/1e3+"s"},Game.prototype.resetCharacters=function(){this.winningCharacter(!1),this.mouth("player-mouth",!1),this.mouth("villan-mouth",!1),this.cells[0].appendChild(this.player.character.element),this.cells[99].appendChild(this.villan.character.element)},Game.prototype.resetBoard=function(){for(var e=this.cells.length,t=0;t<e;t++)this.cells[t].className="cell"},Game.prototype.resetScore=function(){this.player.updateScore(),this.villan.updateScore(),this.winner.innerHTML=""},Game.prototype.winningCharacter=function(e){if(e===!1){for(var t=document.getElementsByClassName("character"),n=t.length,i=0;i<n;i++)Util.removeClass(t[i],"winner");return!0}e.element.className+=" winner"},Game.prototype.mouth=function(e,t){var n=document.getElementsByClassName(e),i=n.length;if(t===!1){for(var r=0;r<i;r++)Util.removeClass(n[r],"smile"),Util.removeClass(n[r],"frown");return!0}for(var r=0;r<i;r++)n[r].className+=" "+t};